{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Jeju App Manifest",
  "description": "Manifest file for Jeju applications (both core apps and vendor apps)",
  "type": "object",
  "required": ["name", "displayName", "version", "type"],
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "description": "Unique identifier (kebab-case)"
    },
    "displayName": {
      "type": "string",
      "description": "Human-readable name"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-z0-9.]+)?$",
      "description": "Semantic version"
    },
    "type": {
      "type": "string",
      "enum": ["core", "vendor", "service"],
      "description": "App type: core (apps/), vendor (vendor/), service (MCP+A2A service)"
    },
    "description": {
      "type": "string",
      "description": "Brief description of the app"
    },
    "commands": {
      "type": "object",
      "description": "Available commands for this app",
      "properties": {
        "dev": { "type": "string" },
        "build": { "type": "string" },
        "test": { "type": "string" },
        "start": { "type": "string" }
      }
    },
    "ports": {
      "type": "object",
      "description": "Port configuration",
      "properties": {
        "main": { "type": "number" },
        "api": { "type": "number" },
        "ui": { "type": "number" },
        "game": { "type": "number" },
        "auth": { "type": "number" },
        "a2a": { "type": "number", "description": "Separate port for A2A server if not on main" },
        "mcp": { "type": "number", "description": "Separate port for MCP server if not on main" }
      }
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["contracts", "config", "shared", "scripts", "indexer", "localnet"]
      },
      "description": "Required Jeju dependencies"
    },
    "optional": {
      "type": "boolean",
      "default": true,
      "description": "Whether this app is optional (won't fail dev if missing)"
    },
    "enabled": {
      "type": "boolean",
      "default": true,
      "description": "Whether this app should be started"
    },
    "autoStart": {
      "type": "boolean",
      "default": true,
      "description": "Whether to auto-start with 'bun run dev'"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Category tags (defi, gaming, monitoring, etc.)"
    },
    "healthCheck": {
      "type": "object",
      "properties": {
        "url": { "type": "string" },
        "interval": { "type": "number" }
      }
    },
    "jns": {
      "type": "object",
      "description": "Jeju Name Service configuration",
      "properties": {
        "name": { "type": "string", "description": "JNS name (e.g., bazaar.jeju)" },
        "description": { "type": "string" },
        "url": { "type": "string", "description": "Public URL" }
      }
    },
    "agent": {
      "type": "object",
      "description": "ERC-8004 agent registration and protocol configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Whether to register as ERC-8004 agent"
        },
        "a2aEndpoint": {
          "type": "string",
          "description": "A2A endpoint path or full URL (e.g., /a2a, /api/a2a, http://localhost:4003/a2a)"
        },
        "mcpEndpoint": {
          "type": "string",
          "description": "MCP endpoint path or full URL (e.g., /mcp, /api/mcp)"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Agent discovery tags (e.g., jeju-app, defi, storage)"
        },
        "metadata": {
          "type": "object",
          "description": "Additional agent metadata",
          "properties": {
            "category": { "type": "string", "description": "Service category (defi, storage, compute, etc.)" },
            "provider": { "type": "string" },
            "features": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "trustModels": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["open", "staked", "verified", "permissioned"]
          },
          "description": "Supported trust models"
        },
        "x402Support": {
          "type": "boolean",
          "default": false,
          "description": "Whether service supports x402 micropayments"
        },
        "multiTokenPayments": {
          "type": "boolean",
          "default": false,
          "description": "Whether service supports ERC-4337 multi-token payments"
        },
        "jnsName": {
          "type": "string",
          "description": "JNS name for this agent"
        }
      }
    },
    "decentralization": {
      "type": "object",
      "description": "Decentralized infrastructure configuration",
      "properties": {
        "database": {
          "type": "object",
          "description": "CovenantQL database configuration",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["covenantql", "cql-sync", "none"],
              "description": "Database mode: covenantql (direct), cql-sync (replicated from Postgres), none"
            },
            "databaseId": {
              "type": "string",
              "description": "Unique database identifier"
            },
            "consistency": {
              "type": "string",
              "enum": ["strong", "eventual", "causal"],
              "description": "Consistency level for reads"
            },
            "replication": {
              "type": "number",
              "minimum": 1,
              "maximum": 5,
              "description": "Replication factor for data"
            }
          },
          "required": ["type"]
        },
        "cache": {
          "type": "object",
          "description": "Decentralized cache configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether to use decentralized cache"
            },
            "namespace": {
              "type": "string",
              "description": "Cache namespace for this app"
            },
            "planId": {
              "type": "string",
              "enum": ["basic", "standard", "premium"],
              "description": "Cache plan tier"
            },
            "ttl": {
              "type": "number",
              "description": "Default TTL in seconds"
            }
          }
        },
        "secrets": {
          "type": "object",
          "description": "Vault-backed secrets configuration",
          "properties": {
            "required": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Required secrets (app fails to start without these)"
            },
            "optional": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Optional secrets (app can start without these)"
            }
          }
        },
        "triggers": {
          "type": "array",
          "description": "Cron, webhook, and event triggers",
          "items": {
            "type": "object",
            "required": ["name", "type", "endpoint"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Unique trigger identifier"
              },
              "type": {
                "type": "string",
                "enum": ["cron", "webhook", "event"],
                "description": "Trigger type"
              },
              "cronExpression": {
                "type": "string",
                "description": "Cron expression (for cron triggers)"
              },
              "webhookPath": {
                "type": "string",
                "description": "Webhook path (for webhook triggers)"
              },
              "eventTypes": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Event types to listen for (for event triggers)"
              },
              "endpoint": {
                "type": "string",
                "description": "Endpoint to call when trigger fires"
              },
              "description": {
                "type": "string",
                "description": "Human-readable description"
              },
              "timeout": {
                "type": "number",
                "description": "Execution timeout in milliseconds"
              },
              "retries": {
                "type": "number",
                "minimum": 0,
                "maximum": 5,
                "description": "Number of retry attempts on failure"
              }
            }
          }
        },
        "frontend": {
          "type": "object",
          "description": "Frontend deployment to IPFS + JNS",
          "properties": {
            "ipfs": {
              "type": "boolean",
              "description": "Whether to deploy frontend to IPFS"
            },
            "jnsName": {
              "type": "string",
              "description": "JNS name for frontend resolution"
            },
            "buildDir": {
              "type": "string",
              "description": "Build output directory (default: dist, build, out)"
            },
            "spa": {
              "type": "boolean",
              "description": "Whether this is a single-page application"
            }
          }
        }
      }
    }
  }
}

